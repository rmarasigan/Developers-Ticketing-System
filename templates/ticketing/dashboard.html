{{ define "title"}}
<title>
	Dashboard Â· Ticketing
</title>
{{ end }}
{{ define "content" }}
<!-- <div class="row" style="width: 100%;">
  <h1 class="tickets-header col-md-10">Tickets</h1>
  <button class="add-ticket-button btn btn-outline-light col-md-2">Add Ticket</button>
</div> -->

<!-- 
  container
    row
      col-*
        el

 -->
<div class="row ticketing-header">
	<div class="col-6 ticketing-header__title">
		<h1 class="tickets-header">Tickets</h1>
	</div>

	<div class="col-6 ticketing-header__button">
		<button class="add-ticket-button btn btn-outline-light btn-lg">Add Ticket</button>
	</div>
</div>

<section class="row">
	<div class="container">
		<div class="search-bar-container">
			<input type="text" placeholder="Search Tickets" class="ticket-searchbar">
			<button type="submit" class="search-icon"><i class="fas fa-search search-icon"></i></button>
		</div>
	</div>
</section>

<!-- <section id="ticket-cards">
  <div class="ticket-card">
    <div class="col-4 ticket-card__left">
      <div class="ticket-card__time"></div>
    </div>
    <div class="col-4 ticket-card__right">
      <div class="ticket-card__number">#1</div>
      <div class="ticket-card__title">Lorem ipsum dolor sit amet.</div>
      <div class="ticket-card__system">Share Cafe</div>
      <div class="ticket-card__date">
        <span class="ticket-date"></span> | <span class="ticket-time"></span>
      </div>

      <div class="ticket-assigned"></div>
    </div>
  </div>
</section> -->

<section id="ticket-append" class="row">

</section>

<div class="modal" tabindex="-1" id="card-modal">
	<div class="modal-dialog modal-xl modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="modal-title">Title</h5>
				<span class="badge priority-badge" id="priority-badge">BADGE</span>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="container" style="margin-bottom: 16px;">
					<div class="row col-12">
						<section class="col-4 date-modal">
							<time class="time-wrapper">
								<span id="created-date-modal" class="span-month">JANUARY</span>
								<span id="created-month-modal" class="span-date">01</span>
								<span id="created-year-modal">1900</span>
							</time>
						</section>
						<section class="col-8">
							<div class="mb-3">
								<h3>Description</h3>
								<!-- <textarea type="text" class="form-control" id="description-input-modal" maxLength="200" readonly></textarea> -->
								<div class="form-control" id="description-input-modal" readonly></div>
							</div>
							<div class="mb-3">
								<label for="system-input-modal mb-3">System</label>
								<input type="text" id="system-input-modal" class="form-control" readonly>
							</div>
							<div class="mb-3">
								<label for="system-input-modal mb-3">Assigned To</label>
								<input type="text" id="assignedto-input-modal" class="form-control" readonly>
							</div>
							<div class="mb-3">
								<label for="system-input-modal mb-3">Priority</label>
								<input type="text" id="priority-input-modal" class="form-control" readonly>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="modal add-ticket-modal" tabindex="-1">
	<div class="modal-dialog modal-xl modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add Ticket</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<!-- <p>Modal body text goes here.</p> -->
				<form action="POST">
					<h5>Ticket Name</h5>
					<input type="text" class="form-control add-ticket__ticketname">
					<h5>Ticket Description</h5>
					<textarea cols="30" rows="5" class="form-control add-ticket__description"></textarea>
					<h5>System</h5>
					<select class="form-select add-ticket__System">
						<option selected></option>
					</select>
					<h5>Priority</h5>
					<select class="form-select add-ticket__priority">
						<option value="0" selected></option>
						<option value="1">Low</option>
						<option value="2">Medium</option>
						<option value="3">High</option>
					</select>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary add-ticket__save" data-action="save-ticket">Save
					changes</button>
			</div>
		</div>
	</div>
</div>
<!-- Ticket Saved Modal -->
<div class="modal ticket_saved" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Ticket Saved</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<h4>Ticket Saved Successfully</h4>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Okay</button>
			</div>
		</div>
	</div>
</div>

{{ end }}
{{ define "script" }}
<script src="/static/ticketing/js/dashboard.js"></script>
<script>
	var system_url = "/admin/api/d/system/read/?"
	$.get(system_url, function (index, response) {
		system_url = JSON.parse(index).result
		console.log("URL", system_url)
		$.each(system_url, function (key, value) {
			$(".add-ticket__System").append($('<option>', {
				value: value.ID,
				text: value.SystemName,
			}));
		})
	})
	// add ticket
	$(".add-ticket-button").on('click', function () {
		$(".add-ticket-modal").modal('show');
	})
	$(".add-ticket__save").on('click', function () {
		console.log("click")
		$.ajax({
			"method": "POST",
			"data":
			{
				"data-action": "save-ticket",
				"name": $(".add-ticket__ticketname").val(),
				"description": $(".add-ticket__description").val(),
				"system": $(".add-ticket__Syatem").val(),
				"priority": $(".add-ticket__priority").val(),
			}, "success": function () {
				console.log("saved")
				$(".add-ticket-modal").modal('hide');
				$(".ticket_saved").modal('show');

				$(".add-ticket__ticketname").val("");
				$(".add-ticket__description").val("");
				$(".add-ticket__System").val("");
				$(".add-ticket__priority").val("");

				$(location).attr('href', '/ticketing/dashboard')
			}
		})
	})
</script>
{{ end }}